<script setup>
import { ref, onMounted } from 'vue'

// DOM
const question = ref('')
const chatGPTResp = ref(null)
const arrowSend = ref(null)
const loadingDots = ref(null)
const loadingDot1 = ref(null)
const loadingDot2 = ref(null)
const loadingDot3 = ref(null)
const firstLoad = ref(true)

let chatGPT = null // Worker

function postSchnaps() {
  firstLoad.value = false
  // Envoi de la question au worker
  chatGPT.postMessage(question.value)

  // Constitution du bloc de question
  const newQueryContainer = document.createElement('div')
  newQueryContainer.className = 'queryContainer'
  const newParagraph = document.createElement('p')
  newParagraph.className = 'query'
  newParagraph.innerHTML = question.value

  const avatar = document.createElement('span')
  avatar.innerText = 'moi'
  avatar.setAttribute('class', 'avatar')
  newQueryContainer.appendChild(avatar)

  newQueryContainer.appendChild(newParagraph)
  chatGPTResp.value.appendChild(newQueryContainer)
  question.value = ''
}

onMounted(() => {
  chatGPT = new Worker('/ia.js') // The üß†
  chatGPT.addEventListener('message', (event) => {
    loadingDots.value.style.display = 'block'

    // Ajout au contenu
    chatGPTResp.value.value = event.data
    const newAnswerContainer = document.createElement('div')
    newAnswerContainer.className = 'answerContainer'

    // L'avatar
    const imgAvatar = document.createElement('img')
    imgAvatar.setAttribute('src', '/schnaps-kiwi.svg')
    imgAvatar.setAttribute('class', 'avatar')
    newAnswerContainer.appendChild(imgAvatar)
    
    // Un paragraphe de r√©ponse
    const newParagraph = document.createElement('p')
    newParagraph.className = 'answer'
    newParagraph.innerHTML = '<span class="type" style="--n:'+event.data.length+'">'+event.data+'</span>'
    newAnswerContainer.appendChild(newParagraph)

    // const span = document.createElement('span')
    // newAnswerContainer.appendChild(span)
    chatGPTResp.value.appendChild(newAnswerContainer)

    // Scroll vertical au fur et √† mesure de l'ajout de contenu
    // window.scrollTo(0, document.body.scrollHeight)
    const container = document.querySelector('.content')
    container.scrollTo(0, container.scrollHeight)

    // Animations
    arrowSend.value.style.display = 'none'
    loadingDot1.value.style.animation = `load 1s steps(${event.data.length})`

    loadingDot2.value.style.animation = `load 1s steps(${event.data.length})`
    loadingDot2.value.style.animationDelay = `0.2s`

    loadingDot3.value.style.animation = `load 1s steps(${event.data.length})`
    loadingDot3.value.style.animationDelay = `0.4s`

    //loadingDot3.value.addEventListener('animationend', function() {
      setTimeout(function() {
      loadingDots.value.style.display = 'none'
      arrowSend.value.style.display = 'block'
    }, 1000)
    //})
  })

})

</script>

<template>
  <div class="content">
    <div class="intro" v-if="firstLoad">
      <!-- Logo -->
      <h1>
        <span class="sr-only">SchnapsGPT</span>
        <svg aria-hidden="true" class="logo" width="418" height="61" viewBox="0 0 418 61" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18.7195 48.768C15.1355 48.768 11.7008 48.2987 8.4155 47.36C5.13017 46.3787 2.48483 45.12 0.4795 43.584L3.9995 35.776C5.9195 37.1413 8.18083 38.272 10.7835 39.168C13.4288 40.0213 16.0955 40.448 18.7835 40.448C20.8315 40.448 22.4742 40.256 23.7115 39.872C24.9915 39.4453 25.9302 38.8693 26.5275 38.144C27.1248 37.4187 27.4235 36.5867 27.4235 35.648C27.4235 34.4533 26.9542 33.5147 26.0155 32.832C25.0768 32.1067 23.8395 31.5307 22.3035 31.104C20.7675 30.6347 19.0608 30.208 17.1835 29.824C15.3488 29.3973 13.4928 28.8853 11.6155 28.288C9.78083 27.6907 8.0955 26.9227 6.5595 25.984C5.0235 25.0453 3.76483 23.808 2.7835 22.272C1.84483 20.736 1.3755 18.7733 1.3755 16.384C1.3755 13.824 2.05817 11.4987 3.4235 9.408C4.8315 7.27466 6.92217 5.58933 9.6955 4.352C12.5115 3.072 16.0315 2.432 20.2555 2.432C23.0715 2.432 25.8448 2.77333 28.5755 3.456C31.3062 4.096 33.7168 5.07733 35.8075 6.4L32.6075 14.272C30.5168 13.0773 28.4262 12.2027 26.3355 11.648C24.2448 11.0507 22.1968 10.752 20.1915 10.752C18.1862 10.752 16.5435 10.9867 15.2635 11.456C13.9835 11.9253 13.0662 12.544 12.5115 13.312C11.9568 14.0373 11.6795 14.8907 11.6795 15.872C11.6795 17.024 12.1488 17.9627 13.0875 18.688C14.0262 19.3707 15.2635 19.9253 16.7995 20.352C18.3355 20.7787 20.0208 21.2053 21.8555 21.632C23.7328 22.0587 25.5888 22.5493 27.4235 23.104C29.3008 23.6587 31.0075 24.4053 32.5435 25.344C34.0795 26.2827 35.3168 27.52 36.2555 29.056C37.2368 30.592 37.7275 32.5333 37.7275 34.88C37.7275 37.3973 37.0235 39.7013 35.6155 41.792C34.2075 43.8827 32.0955 45.568 29.2795 46.848C26.5062 48.128 22.9862 48.768 18.7195 48.768ZM60.748 48.512C57.036 48.512 53.7293 47.7653 50.828 46.272C47.9267 44.736 45.644 42.624 43.98 39.936C42.3587 37.248 41.548 34.1973 41.548 30.784C41.548 27.328 42.3587 24.2773 43.98 21.632C45.644 18.944 47.9267 16.8533 50.828 15.36C53.7293 13.824 57.036 13.056 60.748 13.056C64.3747 13.056 67.532 13.824 70.22 15.36C72.908 16.8533 74.892 19.008 76.172 21.824L68.428 25.984C67.532 24.3627 66.4013 23.168 65.036 22.4C63.7133 21.632 62.2627 21.248 60.684 21.248C58.9773 21.248 57.4413 21.632 56.076 22.4C54.7107 23.168 53.6227 24.256 52.812 25.664C52.044 27.072 51.66 28.7787 51.66 30.784C51.66 32.7893 52.044 34.496 52.812 35.904C53.6227 37.312 54.7107 38.4 56.076 39.168C57.4413 39.936 58.9773 40.32 60.684 40.32C62.2627 40.32 63.7133 39.9573 65.036 39.232C66.4013 38.464 67.532 37.248 68.428 35.584L76.172 39.808C74.892 42.5813 72.908 44.736 70.22 46.272C67.532 47.7653 64.3747 48.512 60.748 48.512ZM102.661 13.056C105.392 13.056 107.824 13.6107 109.957 14.72C112.133 15.7867 113.84 17.4507 115.077 19.712C116.314 21.9307 116.933 24.7893 116.933 28.288V48H106.949V29.824C106.949 27.0507 106.33 25.0027 105.093 23.68C103.898 22.3573 102.192 21.696 99.973 21.696C98.3943 21.696 96.965 22.0373 95.685 22.72C94.4477 23.36 93.4663 24.3627 92.741 25.728C92.0583 27.0933 91.717 28.8427 91.717 30.976V48H81.733V0.511997H91.717V23.104L89.477 20.224C90.7143 17.92 92.485 16.1493 94.789 14.912C97.093 13.6747 99.717 13.056 102.661 13.056ZM146.911 13.056C149.642 13.056 152.074 13.6107 154.207 14.72C156.383 15.7867 158.09 17.4507 159.327 19.712C160.564 21.9307 161.183 24.7893 161.183 28.288V48H151.199V29.824C151.199 27.0507 150.58 25.0027 149.343 23.68C148.148 22.3573 146.442 21.696 144.223 21.696C142.644 21.696 141.215 22.0373 139.935 22.72C138.698 23.36 137.716 24.3627 136.991 25.728C136.308 27.0933 135.967 28.8427 135.967 30.976V48H125.983V13.568H135.519V23.104L133.727 20.224C134.964 17.92 136.735 16.1493 139.039 14.912C141.343 13.6747 143.967 13.056 146.911 13.056ZM191.353 48V41.28L190.713 39.808V27.776C190.713 25.6427 190.052 23.9787 188.729 22.784C187.449 21.5893 185.465 20.992 182.777 20.992C180.942 20.992 179.129 21.2907 177.337 21.888C175.588 22.4427 174.094 23.2107 172.857 24.192L169.273 17.216C171.15 15.8933 173.412 14.8693 176.057 14.144C178.702 13.4187 181.39 13.056 184.121 13.056C189.369 13.056 193.444 14.2933 196.345 16.768C199.246 19.2427 200.697 23.104 200.697 28.352V48H191.353ZM180.857 48.512C178.169 48.512 175.865 48.064 173.945 47.168C172.025 46.2293 170.553 44.9707 169.529 43.392C168.505 41.8133 167.993 40.0427 167.993 38.08C167.993 36.032 168.484 34.24 169.465 32.704C170.489 31.168 172.089 29.9733 174.265 29.12C176.441 28.224 179.278 27.776 182.777 27.776H191.929V33.6H183.865C181.518 33.6 179.897 33.984 179.001 34.752C178.148 35.52 177.721 36.48 177.721 37.632C177.721 38.912 178.212 39.936 179.193 40.704C180.217 41.4293 181.604 41.792 183.353 41.792C185.017 41.792 186.51 41.408 187.833 40.64C189.156 39.8293 190.116 38.656 190.713 37.12L192.249 41.728C191.524 43.9467 190.201 45.632 188.281 46.784C186.361 47.936 183.886 48.512 180.857 48.512ZM230.085 48.512C227.184 48.512 224.645 47.872 222.469 46.592C220.293 45.312 218.586 43.3707 217.349 40.768C216.154 38.1227 215.557 34.7947 215.557 30.784C215.557 26.7307 216.133 23.4027 217.285 20.8C218.437 18.1973 220.101 16.256 222.277 14.976C224.453 13.696 227.056 13.056 230.085 13.056C233.328 13.056 236.229 13.8027 238.789 15.296C241.392 16.7467 243.44 18.7947 244.933 21.44C246.469 24.0853 247.237 27.2 247.237 30.784C247.237 34.4107 246.469 37.5467 244.933 40.192C243.44 42.8373 241.392 44.8853 238.789 46.336C236.229 47.7867 233.328 48.512 230.085 48.512ZM209.733 60.416V13.568H219.269V20.608L219.077 30.848L219.717 41.024V60.416H209.733ZM228.357 40.32C230.021 40.32 231.493 39.936 232.773 39.168C234.096 38.4 235.141 37.312 235.909 35.904C236.72 34.4533 237.125 32.7467 237.125 30.784C237.125 28.7787 236.72 27.072 235.909 25.664C235.141 24.256 234.096 23.168 232.773 22.4C231.493 21.632 230.021 21.248 228.357 21.248C226.693 21.248 225.2 21.632 223.877 22.4C222.554 23.168 221.509 24.256 220.741 25.664C219.973 27.072 219.589 28.7787 219.589 30.784C219.589 32.7467 219.973 34.4533 220.741 35.904C221.509 37.312 222.554 38.4 223.877 39.168C225.2 39.936 226.693 40.32 228.357 40.32ZM265.505 48.512C262.561 48.512 259.723 48.1707 256.993 47.488C254.305 46.7627 252.171 45.8667 250.593 44.8L253.921 37.632C255.499 38.6133 257.355 39.424 259.489 40.064C261.665 40.6613 263.798 40.96 265.889 40.96C268.193 40.96 269.814 40.6827 270.753 40.128C271.734 39.5733 272.225 38.8053 272.225 37.824C272.225 37.0133 271.841 36.416 271.073 36.032C270.347 35.6053 269.366 35.2853 268.128 35.072C266.891 34.8587 265.526 34.6453 264.033 34.432C262.582 34.2187 261.11 33.9413 259.617 33.6C258.123 33.216 256.758 32.6613 255.521 31.936C254.283 31.2107 253.281 30.2293 252.513 28.992C251.787 27.7547 251.424 26.1547 251.424 24.192C251.424 22.016 252.043 20.096 253.281 18.432C254.561 16.768 256.395 15.4667 258.785 14.528C261.174 13.5467 264.033 13.056 267.361 13.056C269.707 13.056 272.097 13.312 274.529 13.824C276.961 14.336 278.987 15.0827 280.609 16.064L277.281 23.168C275.617 22.1867 273.931 21.5253 272.225 21.184C270.561 20.8 268.939 20.608 267.361 20.608C265.142 20.608 263.521 20.9067 262.497 21.504C261.473 22.1013 260.961 22.8693 260.961 23.808C260.961 24.6613 261.323 25.3013 262.049 25.728C262.817 26.1547 263.819 26.496 265.057 26.752C266.294 27.008 267.638 27.2427 269.089 27.456C270.582 27.6267 272.075 27.904 273.569 28.288C275.062 28.672 276.406 29.2267 277.601 29.952C278.838 30.6347 279.841 31.5947 280.609 32.832C281.377 34.0267 281.761 35.6053 281.761 37.568C281.761 39.7013 281.121 41.6 279.841 43.264C278.561 44.8853 276.705 46.1653 274.273 47.104C271.883 48.0427 268.961 48.512 265.505 48.512ZM310.257 48.768C306.715 48.768 303.451 48.2133 300.465 47.104C297.521 45.952 294.939 44.3307 292.72 42.24C290.545 40.1493 288.838 37.696 287.601 34.88C286.406 32.064 285.809 28.9707 285.809 25.6C285.809 22.2293 286.406 19.136 287.601 16.32C288.838 13.504 290.566 11.0507 292.785 8.96C295.003 6.86933 297.606 5.26933 300.593 4.16C303.579 3.008 306.865 2.432 310.449 2.432C314.417 2.432 317.979 3.09333 321.137 4.416C324.337 5.73866 327.025 7.65866 329.201 10.176L322.545 16.32C320.923 14.6133 319.153 13.3547 317.233 12.544C315.313 11.6907 313.222 11.264 310.961 11.264C308.785 11.264 306.801 11.6053 305.009 12.288C303.217 12.9707 301.659 13.952 300.337 15.232C299.057 16.512 298.054 18.0267 297.329 19.776C296.646 21.5253 296.305 23.4667 296.305 25.6C296.305 27.6907 296.646 29.6107 297.329 31.36C298.054 33.1093 299.057 34.6453 300.337 35.968C301.659 37.248 303.195 38.2293 304.945 38.912C306.737 39.5947 308.699 39.936 310.833 39.936C312.881 39.936 314.865 39.616 316.785 38.976C318.747 38.2933 320.646 37.1627 322.481 35.584L328.369 43.072C325.937 44.9067 323.099 46.3147 319.857 47.296C316.657 48.2773 313.457 48.768 310.257 48.768ZM318.897 41.728V24.896H328.369V43.072L318.897 41.728ZM338 48V3.2H357.392C361.402 3.2 364.858 3.86133 367.76 5.184C370.661 6.464 372.901 8.32 374.48 10.752C376.058 13.184 376.848 16.0853 376.848 19.456C376.848 22.784 376.058 25.664 374.48 28.096C372.901 30.528 370.661 32.4053 367.76 33.728C364.858 35.008 361.402 35.648 357.392 35.648H343.76L348.368 30.976V48H338ZM348.368 32.128L343.76 27.2H356.816C360.016 27.2 362.405 26.5173 363.984 25.152C365.562 23.7867 366.352 21.888 366.352 19.456C366.352 16.9813 365.562 15.0613 363.984 13.696C362.405 12.3307 360.016 11.648 356.816 11.648H343.76L348.368 6.72V32.128ZM392.342 48V11.648H378.006V3.2H417.046V11.648H402.71V48H392.342Z" fill="white"/>
        </svg>
      </h1>
      <!-- Blocs d'intro -->
      <div class="wtf">
        <div class="bloc">
          <img src="/bouteille.svg" alt="">
          <p class="bloc-title">Exemples</p>
          <div class="bloc-explain">
            <p class="bloc-text">
              <q> Quel est le nom de village alsacien le plus long&nbsp;? </q>
            </p>
          </div>
          <div class="bloc-explain">
            <p class="bloc-text">
              <q> Quelle est la sp√©cialit√© de Furdenheim&nbsp;? </q>
            </p>
          </div>
        </div>
        <div class="bloc">
          <img src="/poire.svg" alt="">
          <p class="bloc-title">Capacit√©s</p>
          <div class="bloc-explain">
            <p class="bloc-text">
              Ce mod√®le d'IA a √©t√© entra√Æn√© avec les meilleurs algorithmes et beaucoup de schnaps.
            </p>
          </div>
          <div class="bloc-explain">
            <p class="bloc-text">
              Il peut coder dans les langages les plus courants.
            </p>
          </div>
        </div>
        <div class="bloc">
          <img src="/alsacienne.svg" alt="">
          <p class="bloc-title">Limitations</p>
          <div class="bloc-explain">
            <p class="bloc-text">
              C'est un outil conversationnel de 5e g√©n√©ration, √©quivalent √† l'intelligence de Bob l'√âponge.
            </p>
          </div>
          <div class="bloc-explain">
            <p class="bloc-text">
              Il a une connaissance limit√©e des √©v√©nements avant le bug de l'an 2000.
            </p>
          </div>
        </div>
      </div>
    </div><!-- /.intro -->
    <!-- Zone de r√©ponse -->
    <div class="schnapsResponse" ref="chatGPTResp" aria-live="polite" aria-relevant="additions"></div>
  </div><!-- /.content -->
  <div class="bottom">
      <form class="schnapsForm" v-on:submit.prevent="postSchnaps">
          <!-- Question -->
          <label for="question" class="sr-only">Posez votre question</label>
          <input type="text" id="question" class="schnapsQuestion" v-model="question">
          <!-- Bouton d'envoi -->
          <button class="sendButton" v-on:click.prevent="postSchnaps" aria-label="Envoyer la question √† SchnapsGPT">
            <svg ref="arrowSend" aria-hidden="true" width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M11.4441 19.5999C10.0286 20.339 8.34386 19.5609 8.13917 18.0472C7.80937 15.5972 7.49077 13.1443 7.15959 10.695C7.14361 10.5782 7.0707 10.4392 6.97827 10.3682C5.03735 8.86617 3.08908 7.37365 1.14143 5.87901C0.37849 5.29316 0.0930436 4.39433 0.386339 3.49164C0.665896 2.62885 1.44243 2.03136 2.40319 1.94722C8.06582 1.45683 13.73 0.969101 19.3934 0.480043C19.8854 0.437457 20.3768 0.381033 20.8684 0.360002C21.7811 0.323148 22.4831 0.692029 22.8937 1.47956C23.2979 2.25297 23.2156 3.03386 22.6997 3.77387C19.7844 7.94649 16.8684 12.1178 13.9517 16.2912C13.3547 17.1455 12.7694 18.0073 12.1563 18.8496C11.9566 19.1247 11.6846 19.351 11.4455 19.5991L11.4441 19.5999ZM21.3408 3.18759C21.3261 3.17479 21.3127 3.1612 21.298 3.1484C21.2344 3.18156 21.1707 3.21126 21.1086 3.24709C17.0257 5.60434 12.9422 7.96372 8.85551 10.3143C8.64867 10.4337 8.634 10.5612 8.66053 10.7536C8.77501 11.5665 8.87967 12.3814 8.98847 13.194C9.19182 14.7245 9.39439 16.2536 9.59773 17.784C9.64027 18.1092 9.8234 18.3213 10.1476 18.3988C10.4588 18.473 10.7426 18.35 10.9506 18.0541C11.4463 17.3524 11.937 16.6483 12.4276 15.9442C14.9278 12.3645 17.4301 8.78547 19.9303 5.20585C20.4005 4.5331 20.8693 3.86114 21.3395 3.18838L21.3408 3.18759ZM20.5778 1.87553C20.5729 1.86062 20.5672 1.84438 20.5622 1.82947C20.2464 1.85557 19.9319 1.88088 19.6168 1.90832C15.2759 2.28374 10.9342 2.65784 6.59403 3.03459C5.22863 3.15348 3.86399 3.2737 2.49859 3.39258C2.17997 3.42028 1.93989 3.55534 1.81079 3.85716C1.66122 4.20632 1.77456 4.50134 2.18175 4.81493C4.01502 6.22291 5.84813 7.62742 7.67803 9.03911C7.84093 9.16524 7.9641 9.18114 8.15852 9.06889C12.221 6.71453 16.2895 4.36737 20.3558 2.01967C20.4317 1.97589 20.5037 1.92544 20.5772 1.87766L20.5778 1.87553Z" fill="white"/>
            </svg>
          </button>
          <!-- Points loader -->
          <svg aria-hidden="true" id="dots" class="dots" ref="loadingDots" width="132px" height="58px" viewBox="0 0 132 58" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
              <defs></defs>
              <g id="dotsWrapper" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                  <g sketch:type="MSArtboardGroup" fill="#A3A3A3">
                      <circle id="dot1" ref="loadingDot1" sketch:type="MSShapeGroup" cx="90" cy="30" r="3"></circle>
                      <circle id="dot2" ref="loadingDot2" sketch:type="MSShapeGroup" cx="100" cy="30" r="3"></circle>
                      <circle id="dot3" ref="loadingDot3" sketch:type="MSShapeGroup" cx="110" cy="30" r="3"></circle>
                  </g>
              </g>
          </svg>
      </form>
      <p class="mentions">
        SchnapsGPT Apr 1 Version.
        Free Research Preview by <a href="https://www.alsacreations.fr/">Alsacr√©ations</a>.
        Our goal is to make the world a better place.
      </p>
  </div>
</template>

<style>
</style>
